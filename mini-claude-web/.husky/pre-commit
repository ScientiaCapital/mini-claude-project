#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

echo "ğŸ” Running pre-commit checks..."

# Check for tests-disabled directory
if [ -d "tests-disabled" ] || [ -d "mini-claude-web/tests-disabled" ]; then
  echo "âŒ ERROR: tests-disabled directory detected!"
  echo "This violates test integrity. All tests must remain in the tests/ directory."
  echo "Please move tests back to tests/ and ensure they pass or fix them."
  exit 1
fi

# Check for skipped tests
if grep -r "test\.skip\|describe\.skip\|it\.skip\|xtest\|xdescribe\|xit" --include="*.test.ts" --include="*.test.tsx" tests/ mini-claude-web/tests/ 2>/dev/null; then
  echo "âŒ ERROR: Skipped tests detected!"
  echo "All tests must run. Please fix failing tests instead of skipping them."
  exit 1
fi

# Validate minimum test count
cd mini-claude-web 2>/dev/null || true
if command -v npm >/dev/null 2>&1; then
  echo "ğŸ“Š Validating test count..."
  node scripts/validate-tests.js || exit 1
fi

echo "âœ… Pre-commit checks passed!"